<div style="background: #f5f5f5; padding: 20px; border-radius: 5px; margin: 20px 0; border: 1px solid #ddd;">
    <h3 style="color: #333; margin-top: 0;"> Dashboard del Operativo: {{ instance.titulo }}</h3>
    
    <!-- Contenedor para los indicadores -->
    <div id="dashboard-{{ instance.id }}" class="operativo-dashboard" data-operativo="{{ instance.titulo }}">
        <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
            <!-- Tarjeta para el contador -->
            <div class="metric-card">
                <h4>Total de Participantes</h4>
                <div class="metric-value" id="contador-{{ instance.id }}">
                    <span class="loading-spinner"></span>
                    Cargando...
                </div>
                <div class="metric-label">Registrados en este operativo</div>
            </div>
            
            <!-- Tarjeta para g茅nero -->
            <div class="metric-card">
                <h4>Distribuci贸n por Sexo</h4>
                <div class="metric-details" id="sexo-{{ instance.id }}">
                    <span class="loading-spinner"></span>
                    Cargando...
                </div>
                <div class="metric-label">Desglose por Sexo</div>
            </div>
            
            <!-- Tarjeta para clasificaci贸n -->
            <div class="metric-card">
                <h4>Distribuci贸n por Clasificaci贸n</h4>
                <div class="metric-details" id="clasificacion-{{ instance.id }}">
                    <span class="loading-spinner"></span>
                    Cargando...
                </div>
                <div class="metric-label">Tipos de clasificaci贸n</div>
            </div>

            <!-- Tarjeta para tipo de contrato -->
            <div class="metric-card">
                <h4>Distribuci贸n por Condici贸nn</h4>
                <div class="metric-details" id="condicion-{{ instance.id }}">
                    <span class="loading-spinner"></span>
                    Cargando...
                </div>
                <div class="metric-label">Tipos de contrato</div>
            </div>
        </div>
    </div>
</div>

<style>
    .metric-card
    {
        background:     white;
        padding:        20px;
        border-radius:  8px;
        box-shadow:     0 2px 4px rgba(0,0,0,0.1);
        min-width:      250px;
        flex:           1;
    }
    .metric-value
    {
        font-size:      24px;
        font-weight:    bold;
        color:          #3b82f6;
        margin:         10px 0;
        min-height:     36px;
    }
    .metric-details
    {
        font-size:      16px;
        color:          #4b5563;
        margin:         10px 0;
        min-height:     36px;
        line-height:    1.5;
    }
    .metric-label 
    {
        font-size:      14px;
        color:          #6b7280;
    }
    .loading-spinner 
    {
        display:        inline-block;
        width:          16px;
        height:         16px;
        border:         2px solid #f3f3f3;
        border-top:     2px solid #3b82f6;
        border-radius:  50%;
        animation:      spin 1s linear infinite;
        margin-right:   8px;
    }
    .data-item 
    {
        display:        block;
        margin-bottom:  5px;
        padding:        3px 0;
        border-bottom:  1px solid #f3f4f6;
    }
    .data-item:last-child 
    {
        border-bottom: none;
    }
    @keyframes spin 
    {
          0% { transform: rotate(0deg);     }
        100% { transform: rotate(360deg);   }
    }
</style>





<script>
    // Funci贸n para formatear matrices de datos
    function formatearDatos(data)
    {
        if (!Array.isArray(data)) return data;
        
        let html = '';
        data.forEach(item => 
        {
            if (item.descripcion && item.valor !== undefined)
            {
                html += `<div class="data-item"><strong>${item.descripcion}:</strong> ${item.valor}</div>`;
            }
        });
        return html;
    }

    // Funci贸n para hacer peticiones a la API
    async function solicitarMetricas(operativo, endpoint, elementId, isArray = false)
    {
        const element = document.getElementById(elementId);
        
        try 
        {
            const response = await fetch(`http://localhost:8000/estadisticas/${endpoint}/${encodeURIComponent(operativo)}/`);
            if (!response.ok) throw new Error('Error en la petici贸n');
            const data = await response.json();
            
            // Formatear los datos seg煤n el tipo de respuesta
            if (isArray) 
            {
                element.innerHTML = formatearDatos(data);
            } 
            
            else 
            {
                element.innerHTML = data;
            }
        } 
        
        catch (error) 
        {
            console.error('Error:', error);
            element.innerHTML = 'Error al cargar datos';
        }
    }

    // Funci贸n para cargar todos los datos de un dashboard
    async function datosTablero(dashboard)
    {
        const operativo     = dashboard.dataset.operativo;
        const instanceId    = dashboard.id.split('-')[1];
        
        // Hacer todas las peticiones en paralelo
        await Promise.all
        ([
            solicitarMetricas(operativo, 'contador',      `contador-${instanceId}`,       false),
            solicitarMetricas(operativo, 'sexo',          `sexo-${instanceId}`,           true),
            solicitarMetricas(operativo, 'clasificacion', `clasificacion-${instanceId}`,  true),
            solicitarMetricas(operativo, 'condicion',     `condicion-${instanceId}`,      true)
        ]);
    }

    document.addEventListener('DOMContentLoaded', function() 
    {
        // Seleccionar todos los dashboards
        const dashboards = document.querySelectorAll('.operativo-dashboard');
        
        // Cargar datos para cada dashboard
        dashboards.forEach(dashboard => 
        {
            datosTablero(dashboard);
        });
    });
</script>